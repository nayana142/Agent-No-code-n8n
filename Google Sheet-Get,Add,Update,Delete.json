{
  "name": "Google Sheet-Get,Add,Update,Delete",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        -288,
        -32
      ],
      "id": "e3a79361-29fd-4109-96b6-ab2ffe6408fd",
      "name": "When chat message received",
      "webhookId": "934a8e36-6730-4ab4-8982-a6b447d9eaca"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=# Overview  \nYou are an AI assistant that manages and updates lead information whenever a chat message is received. You analyze user queries, extract relevant lead details, and manage them in Google Sheets accordingly. You ensure accuracy, clarity, and confirmation before performing updates or deletions. The assistant also uses **simple memory** to remember recent interactions during the current conversation.  \n\n## Context  \n- Workflow starts when a **chat message** is received.  \n- The AI Agent uses the **Google Gemini Chat Model** for natural language understanding.  \n- Lead information is stored in a **Google Sheet (Lead data)**.  \n- **Add data (Append: Sheet)**: Appends new lead details into the sheet.   \n- **Update data (Update: Sheet)**: Updates lead details in the sheet.  \n- **Delete rows (Delete: Sheet)**: Deletes one or more rows of lead data when requested.  \n- **Memory**: Stores recent user queries and agent responses for reference in the same conversation (e.g., remembering a Student id or name just mentioned).  \n\n## Instructions  \n1. Receive and interpret user chat messages.  \n2. If the query is about leads (adding, updating, retrieving, or deleting), extract structured information such as:  \n   - Student id  \n   - Lead name  \n   - Source of enquiry \n   - No of times follow up    \n   - Status (e.g., New, Cold, Warm)  \n3. Check **Lead data** (Google Sheet) for existing entries.  \n4. If updating or deleting: confirm the details with the user before applying changes.  \n5. Use the **Add data** tool to append new lead information into the sheet.  \n6. Use the **Update data** tool to modify existing lead records.  \n7. Use the **Delete rows** tool to remove specific lead entries when required.  \n8. Store recent references (like Student id or Name) in **memory**, so if the user later says *“Update the last lead I mentioned”*, the system knows which record to use.  \n9. Provide confirmation to the user once the operation is successful.  \n\n## Tools  \n- **Google Gemini Chat Model**: Understands and processes natural language inputs.  \n- **Lead data (Read: Sheet)**: Retrieves existing lead information.  \n- **Add data (Append: Sheet)**: Appends new lead details into the sheet.     \n- **Update data (Update: Sheet)**: Updates existing lead details in the sheet.  \n- **Delete rows (Delete: Sheet)**: Removes lead records from the sheet.  \n- **Memory**: Stores recent user inputs and agent responses for reference in the same session.  \n\n## Examples  \n- **Input:** \"Add John Doe with Source of enquiry: Youtube and status Cold, No of times follow up: 3.\"  \n  - Extract details → Name: John Doe, Source: Youtube, Status: Cold, Follow-ups: 3.  \n  - Append to lead sheet using **Add data**.  \n  - Save \"John Doe\" in memory for quick reference.  \n  - **Output:** \"Lead John Doe has been added successfully.\"  \n\n- **Input:** \"Update the lead I just added to Warm.\"  \n  - Use memory to recall \"John Doe\" was the last added lead.  \n  - Update John Doe’s record with new status\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -16,
        -32
      ],
      "id": "a04420a5-7bdf-4478-9438-2cb671662f35",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -240,
        240
      ],
      "id": "ba712a77-01b2-42aa-9228-9caaf37f21ae",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "5A0mdluJGCEyufEi",
          "name": "Google Gemini(PaLM) Api account 2"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Get row(s) in sheet in Google Sheets",
        "documentId": {
          "__rl": true,
          "value": "1Wr5fTtPgPwO8N0J-od6bz52MbzvlySkPhMIfJWASMPs",
          "mode": "list",
          "cachedResultName": "student data",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wr5fTtPgPwO8N0J-od6bz52MbzvlySkPhMIfJWASMPs/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 312716623,
          "mode": "list",
          "cachedResultName": "lead data",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wr5fTtPgPwO8N0J-od6bz52MbzvlySkPhMIfJWASMPs/edit#gid=312716623"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        64,
        256
      ],
      "id": "b83d4ed9-b569-4607-88ec-f39dce7175c2",
      "name": "Get data",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "XHbg3YuiiIiwh8JA",
          "name": "Nayana_galtech"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1Wr5fTtPgPwO8N0J-od6bz52MbzvlySkPhMIfJWASMPs",
          "mode": "list",
          "cachedResultName": "student data",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wr5fTtPgPwO8N0J-od6bz52MbzvlySkPhMIfJWASMPs/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 312716623,
          "mode": "list",
          "cachedResultName": "lead data",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wr5fTtPgPwO8N0J-od6bz52MbzvlySkPhMIfJWASMPs/edit#gid=312716623"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Name ": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Name___using_to_match_', ``, 'string') }}",
            "Status": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Status', ``, 'string') }}",
            "Source of enquiry": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Source_of_enquiry', ``, 'string') }}",
            "No of times follow up": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('No_of_times_follow_up', ``, 'string') }}",
            "Student id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Student_id', ``, 'string') }}"
          },
          "matchingColumns": [
            "Name "
          ],
          "schema": [
            {
              "id": "Student id",
              "displayName": "Student id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Name ",
              "displayName": "Name ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Source of enquiry",
              "displayName": "Source of enquiry",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "No of times follow up",
              "displayName": "No of times follow up",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        336,
        256
      ],
      "id": "9a7f33ea-bd1a-494e-af94-fdfd076e14a3",
      "name": "Update data",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "XHbg3YuiiIiwh8JA",
          "name": "Nayana_galtech"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "documentId": {
          "__rl": true,
          "value": "1Wr5fTtPgPwO8N0J-od6bz52MbzvlySkPhMIfJWASMPs",
          "mode": "list",
          "cachedResultName": "student data",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wr5fTtPgPwO8N0J-od6bz52MbzvlySkPhMIfJWASMPs/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 312716623,
          "mode": "list",
          "cachedResultName": "lead data",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wr5fTtPgPwO8N0J-od6bz52MbzvlySkPhMIfJWASMPs/edit#gid=312716623"
        },
        "startIndex": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start_Row_Number', ``, 'number') }}"
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        480,
        256
      ],
      "id": "df21d4b3-87a4-4ae5-ad0a-3d8807581889",
      "name": "Delete rows",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "XHbg3YuiiIiwh8JA",
          "name": "Nayana_galtech"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -80,
        256
      ],
      "id": "acef3994-78ff-4297-a514-9fe56beb9793",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1Wr5fTtPgPwO8N0J-od6bz52MbzvlySkPhMIfJWASMPs",
          "mode": "list",
          "cachedResultName": "student data",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wr5fTtPgPwO8N0J-od6bz52MbzvlySkPhMIfJWASMPs/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 312716623,
          "mode": "list",
          "cachedResultName": "lead data",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Wr5fTtPgPwO8N0J-od6bz52MbzvlySkPhMIfJWASMPs/edit#gid=312716623"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Source of enquiry": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Source_of_enquiry', ``, 'string') }}",
            "Name ": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Name_', ``, 'string') }}",
            "No of times follow up": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('No_of_times_follow_up', ``, 'string') }}",
            "Status": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Status', ``, 'string') }}",
            "Student id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Student_id', ``, 'string') }}",
            "Processed": " "
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Student id",
              "displayName": "Student id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Name ",
              "displayName": "Name ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Source of enquiry",
              "displayName": "Source of enquiry",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "No of times follow up",
              "displayName": "No of times follow up",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Processed",
              "displayName": "Processed",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [
        208,
        256
      ],
      "id": "28d024c0-1485-4c89-af3b-811ec767e77b",
      "name": "Add data",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "XHbg3YuiiIiwh8JA",
          "name": "Nayana_galtech"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Get data": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Update data": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Delete rows": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Add data": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "060fecbe-e2c1-4674-965e-2c6577858e49",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "6ae6435382c4da0f9a88fd7eff013c6028337c2272750b4c951c6df4243367ad"
  },
  "id": "Syng9iPaGWP5NyuG",
  "tags": []
}